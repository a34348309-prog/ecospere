
generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  directUrl  = env("DIRECT_URL")
  extensions = [postgis]
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// USER â€” Auth, eco tracking, home location
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model User {
  id                 String   @id @default(uuid())
  name               String
  email              String   @unique
  password           String
  level              Int      @default(1)
  ecoScore           Int      @default(0)
  carbonDebt         Float    @default(0)
  totalTreesPlanted  Int      @default(0)
  oxygenContribution Float    @default(0)
  lifetimeCarbon     Float    @default(0)
  treesToOffset      Int      @default(0)
  homeLocation       Unsupported("geometry(Point, 4326)")?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  // Relations
  joinedEvents   Event[]         @relation("UserEvents")
  hostedEvents   Event[]         @relation("UserHostedEvents")
  aqiLogs        AQILog[]
  carbonBills    CarbonBill[]
  impactLedger   ImpactLedger[]
  sentRequests   Friendship[]    @relation("FriendshipSender")
  receivedRequests Friendship[]  @relation("FriendshipReceiver")
  activityLogs   ActivityLog[]
  lifestyleProfile LifestyleProfile?
  ecoPlan          UserEcoPlan?
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// FRIENDSHIP â€” Friend connections between users
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model Friendship {
  id        String   @id @default(uuid())
  userId    String
  friendId  String
  status    String   @default("accepted") // pending | accepted | rejected
  createdAt DateTime @default(now())

  user   User @relation("FriendshipSender", fields: [userId], references: [id])
  friend User @relation("FriendshipReceiver", fields: [friendId], references: [id])

  @@unique([userId, friendId])
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// EVENT â€” Community planting events (Point-based location)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model Event {
  id                  String   @id @default(uuid())
  title               String
  description         String
  organizer           String
  date                DateTime
  time                String
  locationName        String
  coordinates         Unsupported("geometry(Point, 4326)")
  currentParticipants Int      @default(0)
  maxParticipants     Int      @default(50)
  createdAt           DateTime @default(now())

  hostId       String
  host         User   @relation("UserHostedEvents", fields: [hostId], references: [id])
  participants User[] @relation("UserEvents")
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PLANTATION_EVENT â€” Drives with a physical site boundary (Polygon)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model PlantationEvent {
  id            String   @id @default(uuid())
  title         String
  description   String
  organizerName String
  date          DateTime
  locationName  String
  siteBoundary  Unsupported("geometry(Polygon, 4326)")
  centroid      Unsupported("geometry(Point, 4326)")
  treesPlanted  Int      @default(0)
  treesGoal     Int      @default(100)
  status        String   @default("upcoming") // upcoming | active | completed
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  impactRecords ImpactLedger[]
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// IMPACT_LEDGER â€” Links users â†” plantation events for verification
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model ImpactLedger {
  id               String   @id @default(uuid())
  userId           String
  plantationId     String
  attended         Boolean  @default(false)
  treesContributed Int      @default(0)
  verifiedAt       DateTime?
  createdAt        DateTime @default(now())

  user      User            @relation(fields: [userId], references: [id])
  plantation PlantationEvent @relation(fields: [plantationId], references: [id])

  @@unique([userId, plantationId])
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// AQI_LOG â€” Per-user AQI readings with location + TTL cleanup
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model AQILog {
  id        String   @id @default(uuid())
  userId    String
  aqiValue  Int
  location  Unsupported("geometry(Point, 4326)")
  status    String   // Good | Moderate | Unhealthy ...
  timestamp DateTime @default(now())
  expiresAt DateTime // TTL: auto-cleanup target

  user User @relation(fields: [userId], references: [id])

  @@index([userId, timestamp])
  @@index([expiresAt])
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CARBON_BILL â€” Utility bill OCR extraction & carbon calculation
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model CarbonBill {
  id             String   @id @default(uuid())
  userId         String
  billType       String   // electricity | gas | water
  rawText        String?  // OCR-extracted raw text
  totalUnits     Float    // kWh or units consumed
  carbonKg       Float    // totalUnits Ã— emission factor
  billDate       DateTime?
  imagePath      String?  // path to uploaded image
  extractedData  Json?    // structured OCR results
  createdAt      DateTime @default(now())

  user User @relation(fields: [userId], references: [id])

  @@index([userId, createdAt])
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// NGO â€” Environmental organizations
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model NGO {
  id          String   @id @default(uuid())
  name        String
  description String
  address     String
  website     String?
  coordinates Unsupported("geometry(Point, 4326)")
  createdAt   DateTime @default(now())
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// AQI_RECORD â€” Global AQI station snapshots (legacy/global data)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model AQIRecord {
  id           String   @id @default(uuid())
  value        Int
  locationName String
  coordinates  Unsupported("geometry(Point, 4326)")
  timestamp    DateTime @default(now())
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ACTIVITY_LOG â€” Daily lifestyle activity tracking for eco tips
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model ActivityLog {
  id        String   @id @default(uuid())
  userId    String
  category  String   // transport | food | energy | waste
  activity  String   // e.g. "drove_car", "ate_veg", "used_ac"
  value     Float    // km driven, hours of AC, meals, kg recycled
  carbonKg  Float    // calculated COâ‚‚ impact (negative = offset)
  date      DateTime @default(now())
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id])

  @@index([userId, date])
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// LIFESTYLE_PROFILE â€” User preferences & lifestyle data for eco plan
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model LifestyleProfile {
  id                    String   @id @default(uuid())
  userId                String   @unique
  commuteDistance        Float    @default(0)       // km per day
  vehicleType           String   @default("none")   // car | bike | public_transport | none
  monthlyElectricity    Float    @default(0)        // kWh
  age                   Int      @default(25)
  city                  String   @default("")
  dietaryPreference     String   @default("non_vegetarian") // non_vegetarian | vegetarian | vegan | flexitarian
  meatMealsPerWeek      Int      @default(7)
  hasGarden             Boolean  @default(false)
  homeOwnership         String   @default("rent")   // own | rent
  householdSize         Int      @default(1)
  acUsageHours          Float    @default(0)        // hours per day in summer
  wasteRecycling        String   @default("sometimes") // always | sometimes | never
  monthlyGroceryBill    Float    @default(0)        // approx â‚¹
  willingnessChangeDiet Int      @default(3)        // 1-5 scale
  willingnessPublicTransport Int @default(3)        // 1-5 scale
  timeAvailability      String   @default("medium") // low | medium | high
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  user User @relation(fields: [userId], references: [id])
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ECO_ACTION â€” Database of all possible eco-actions
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model EcoAction {
  id              String   @id @default(uuid())
  name            String
  category        String   // energy | transport | diet | waste | tree_planting
  description     String
  icon            String   @default("ðŸŒ±")
  carbonSavedKg   Float    // kg COâ‚‚ saved per month
  monthlySavings  Float    @default(0) // â‚¹ saved per month
  upfrontCost     Float    @default(0) // â‚¹ one-time cost
  difficulty      Int      @default(3) // 1-5 scale
  phase           String   @default("short_term") // immediate | short_term | medium_term | long_term
  requiresGarden  Boolean  @default(false)
  requiresHomeOwnership Boolean @default(false)
  minHouseholdSize Int     @default(1)
  applicableVehicles String[] @default([])  // empty = all
  applicableDiets    String[] @default([])  // empty = all
  treesEquivalent Float    @default(0) // trees offset equivalent per month
  tips            String   @default("")
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())

  planActions UserPlanAction[]
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// USER_ECO_PLAN â€” Saved personalized plan for each user
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model UserEcoPlan {
  id                   String   @id @default(uuid())
  userId               String   @unique
  treesNeeded          Int      @default(0)       // total tree debt
  treesReducedByActions Float   @default(0)       // trees offset via lifestyle changes
  treesRemaining       Float   @default(0)        // trees left to sponsor
  totalMonthlySavings  Float   @default(0)        // â‚¹ per month
  totalUpfrontCost     Float   @default(0)        // â‚¹ one-time
  totalYearlySavings   Float   @default(0)        // â‚¹ year 1 net
  totalCO2Reduced      Float   @default(0)        // kg COâ‚‚ reduced annually
  sponsorCost          Float   @default(0)        // â‚¹ to sponsor remaining trees
  netSavingsYear1      Float   @default(0)        // â‚¹ net savings year 1
  planData             Json?                       // full serialized plan JSON
  generatedAt          DateTime @default(now())
  expiresAt            DateTime                   // plan regeneration window
  completionPercent    Float    @default(0)
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  user    User             @relation(fields: [userId], references: [id])
  actions UserPlanAction[]
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// USER_PLAN_ACTION â€” Tracks user progress on each action in plan
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
model UserPlanAction {
  id          String   @id @default(uuid())
  planId      String
  actionId    String
  phase       String   // immediate | short_term | medium_term | long_term
  isCompleted Boolean  @default(false)
  completedAt DateTime?
  score       Float    @default(0)  // personalized relevance score
  createdAt   DateTime @default(now())

  plan   UserEcoPlan @relation(fields: [planId], references: [id], onDelete: Cascade)
  action EcoAction   @relation(fields: [actionId], references: [id])

  @@unique([planId, actionId])
}
